//
//  WDRegisterChildViewController.m
//  TangTradePlatform
//
//  Created by ctcios2 on 2017/9/21.
//  Copyright © 2017年 com.tang.trade. All rights reserved.
//

#import "WDRegisterChildViewController.h"
#import "WDRegisterCardView.h"
@interface WDRegisterChildViewController ()
@property (nonatomic,strong) WDRegisterCardView *cardView;

@property (nonatomic,strong) WDRegisterViewModel *viewModel;

@end

@implementation WDRegisterChildViewController

- (void)loadView {
    [super loadView];
    
    _cardView = [WDRegisterCardView creatXib];
    
    self.view = _cardView;
}

- (void)viewDidLoad {
    [super viewDidLoad];
    
    self.view.layer.shadowColor = RGBColor(227, 227, 227, 1).CGColor;
    
    self.view.layer.cornerRadius = 20;
    
    self.view.layer.shadowOpacity = 0.8f;
    
    self.view.layer.masksToBounds = YES;
    
    self.view.layer.shadowRadius = 5;
    
    self.view.layer.shadowOffset = CGSizeMake(0,0);
    
    _viewModel = [[WDRegisterViewModel alloc] init];
    
    [_cardView bindViewModel:_viewModel];
    
    @weakify(self)
    
    [self.viewModel.registerSubject subscribeNext:^(id x) {
        @strongify(self);
        
        if ([self.viewModel.password isEqualToString:self.viewModel.confirmPassword]) {
            [self.viewModel registerWithSuccess:^{
                [UIViewController jumpToMainWithName:self.viewModel.userName password:self.viewModel.password];
            } failture:^{
                NSString *message = @"该用户已注册";
                NSString *title = @"注册失败";
                NSString *confirm = @"确定";
                [UIAlertController showAlert:YES fromVC:self withTitle:title message:message withButtonTitle:@[confirm] clickAction:^(NSInteger index, NSString *title) {
                    
                }];
            } error:^{
                NSString *message = @"网络连接失败,请稍后再试";
                NSString *title = @"注册失败";
                NSString *confirm = @"确定";
                [UIAlertController showAlert:YES fromVC:self withTitle:title message:message withButtonTitle:@[confirm] clickAction:^(NSInteger index, NSString *title) {
                    
                }];
            }];
        }else {
            NSString *message = @"密码和确认密码不一致，请修改";
            NSString *title = @"提示";
            NSString *confirm = @"确定";
            [UIAlertController showAlert:YES fromVC:self withTitle:title message:message withButtonTitle:@[confirm] clickAction:^(NSInteger index, NSString *title) {
                
            }];
        }
    }];
    
    [self.viewModel.backSubject subscribeNext:^(id x) {
        @strongify(self);
        
        [self clearKeyBoard];
        
        UIScrollView *scroll = (UIScrollView *)self.view.superview.superview;
        
        [scroll setContentOffset:CGPointMake(0, 0) animated:YES];
        
        [self.viewModel clear];
    }];
}


- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

/*
#pragma mark - Navigation

// In a storyboard-based application, you will often want to do a little preparation before navigation
- (void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender {
    // Get the new view controller using [segue destinationViewController].
    // Pass the selected object to the new view controller.
}
*/

@end
